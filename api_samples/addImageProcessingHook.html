<!DOCTYPE html>
<html>
<head>
<script src="http://maps.kosmosnimki.ru/api/api.js?key=U92596WMIH" charset="windows-1251"></script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>GeoMixer API - пример использования команды добавления массива векторных объектов на карту</title>
</head>

<body>
<div id="map" style="width: 800px; height: 600px; float: left;"></div> <!--задаем контейнер, в который загружается карта -->
<div id="description" style="width: 400px; overflow: auto; padding-left: 20px;">
Показан пример дополнительной обработки тайлов КР(каталога растров)
</div>
	<script>

		createKosmosnimkiMap(document.getElementById("map"), 'maps.kosmosnimki.ru', 'AZR6A', function(map)
		{
			map.moveTo(40.41, 64.79, 3);//позиционирует карту по координатам центра и выбирает масштаб
            var layerID = 'EB271FC4D2AD425A9BAA78ADEA041AB9';
            map.layers.map(function(item) {
                item.setVisible(false);
            });

            var layer = map.layers[layerID];
            layer.addImageProcessingHook(function(img, attrs) {
                //console.log(arguments);
                (function() {
                    var callback = attrs.callback;
                    setTimeout(function() {
                        var canvas = document.createElement('canvas');
                        canvas.width = canvas.height = 256;
                        var ctx = canvas.getContext('2d');
                        ctx.beginPath();
                        ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                        ctx.arc(128, 128, 50, 0, 2*Math.PI);
                        ctx.closePath();
                        ctx.fill();
                        callback(canvas);
                    }, 10);
                })();
                
                //return null;  // если не нужно отрисовывать исходный тайл
                return img;     // если нужно отрисовывать поверх исходного тайла
            }, 'anonymous') ;           
            layer.setVisible(true);
		});
	</script>
</body>
</html>
